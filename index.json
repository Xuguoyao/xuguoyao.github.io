[{"categories":["go"],"content":"安装swag cli 及下载相关包 ","date":"2021-08-28","objectID":"/posts/swaggo/:1:0","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["go"],"content":"要使用swaggo,首先需要安装swag cli。 $ go get -u github.com/swaggo/swag/cmd/swag 然后我们还需要两个包。 ","date":"2021-08-28","objectID":"/posts/swaggo/:1:1","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["go"],"content":"gin-swagger 中间件 $ go get github.com/swaggo/gin-swagger ","date":"2021-08-28","objectID":"/posts/swaggo/:1:2","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["go"],"content":"swagger 内置文件 $ go get github.com/swaggo/gin-swagger/swaggerFiles ","date":"2021-08-28","objectID":"/posts/swaggo/:1:3","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["go"],"content":"在api处根据api添加描述 import ( \"github.com/gin-gonic/gin\" ginSwagger \"github.com/swaggo/gin-swagger\" \"github.com/swaggo/gin-swagger/swaggerFiles\" ) // @title Swagger Example API // @version 1.0 // @description This is a sample server celler server. // @termsOfService https://razeen.me // @contact.name Razeen // @contact.url https://razeen.me // @contact.email me@razeen.me // @license.name Apache 2.0 // @license.url http://www.apache.org/licenses/LICENSE-2.0.html // @host 127.0.0.1:8080 // @BasePath /api/v1 func main() { r := gin.Default() store := sessions.NewCookieStore([]byte(\"secret\")) r.Use(sessions.Sessions(\"mysession\", store)) r.GET(\"/swagger/*any\", ginSwagger.WrapHandler(swaggerFiles.Handler)) v1 := r.Group(\"/api/v1\") { v1.GET(\"/hello\", HandleHello) } r.Run(\":8080\") } // @Summary 测试SayHello // @Description 向你说Hello // @Tags 测试 // @Accept mpfd // @Produce json // @Param who query string true \"人名\" // @Success 200 {string} json \"{\"msg\": \"hello Razeen\"}\" // @Failure 400 {string} json \"{\"msg\": \"who are you\"}\" // @Router /hello [get] func HandleHello(c *gin.Context) { who := c.Query(\"who\") if who == \"\" { c.JSON(http.StatusBadRequest, gin.H{\"msg\": \"who are u?\"}) return } c.JSON(http.StatusOK, gin.H{\"msg\": \"hello \" + who}) } 保存之后再命令行写 swag init ","date":"2021-08-28","objectID":"/posts/swaggo/:1:4","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["go"],"content":"成功后在统计目录会生成一个docs目录,里面有三个文件： docs.go swagger.json swagger.yaml 最后go run main,go 也成功 原以为在浏览器访问 http://127.0.0.1:8080/swagger/index.html 肯定是成功的，没想到页面显示是 Fetch errorInternal Server Error doc.json 一开始可能是注释写漏了或者是写错了，但是各种尝试修改都不行。 最后查到说是需要引入docs目录才行。 import ( \"github.com/gin-gonic/gin\" ginSwagger \"github.com/swaggo/gin-swagger\" \"github.com/swaggo/gin-swagger/swaggerFiles\" _ \"gin-admin/docs\" ) 最后用上面的方式果然成功 ","date":"2021-08-28","objectID":"/posts/swaggo/:1:5","tags":["go","swaggo"],"title":"使用swaggo时要注意的一点","uri":"/posts/swaggo/"},{"categories":["php"],"content":"通过PHPExcle把excle表导入数据库，变成数据表；也就是一个excle表对应就是一个数据表： Excle表里的格式为： . A B C 1 对应数据库的字段 对应数据库的字段 对应数据库的字段 2 字段的注释 字段的注释 字段的注释 3 值 值 值 代码： \u003c?php header(\"Content-Type:text/html;charset=utf-8\"); error_reporting(0); define('FY_MTIME',microtime(TRUE)); require_once 'inc/config.php'; $d = dir('xls/'); while (($file = $d-\u003eread()) !== false){ if(substr(strrchr($file, '.'), 1) == 'xls'){ $arr[] = $file; } } //我是把所有xls文件列出列表，勾选提交到这边$_POST foreach($_POST as $k =\u003e $item){ foreach($item as $v){ getExeclData('xls/'.$arr[$v]); } } /** * 获取Execl表格数据 */ function getExeclData($file) { //首先导入PhPExcel require_once 'PHPExcel/PHPExcel.php'; $filePath = $file; if ($filePath == null || $filePath == '') { return; } $PHPReader = new PHPExcel_Reader_Excel5(); if (!$PHPReader-\u003ecanRead($filePath)) { echo 'no Excel'; return; } //建立excel对象，此时你即可以通过excel对象读取文件，也可以通过它写入文件 $PHPExcel = $PHPReader-\u003eload($filePath); /**读取excel文件中的第一个工作表*/ $currentSheet = $PHPExcel-\u003egetSheet(0); /**取得最大的列号*/ $allColumn = $currentSheet-\u003egetHighestColumn(); /**取得一共有多少行*/ $allRow = $currentSheet-\u003egetHighestRow(); //下面改成'!=',所以把$allColumn+1,'\u003c='就有问题 $allColumn++; //获取excle表中第一行的字段名 $hdata = array(); $null = array(); for($colIndex='A'; $colIndex != $allColumn; $colIndex++){ $haddr = $colIndex . 1; //编号A1、B1 $hcell = $currentSheet-\u003egetCell($haddr)-\u003egetValue(); //编号对应的值 if(!empty($hcell)){ array_push($hdata, $hcell); }else{ array_push($null[$colIndex], $hcell); } } //把excel的空字段组成数组 $key = array_keys($null); //获取xls文件名，与数据表同名 $filePath = substr($filePath,strpos($filePath,'/')+1); $sheetName = explode('.',$filePath); $sheetName = $sheetName[0]; //把数据表的字段列出来 foreach($hdata as $k =\u003e $item){ if(!empty($item)){ if($k == 0){ $field .= '`'.$item.'`'; }else{ $field .= ','.'`'.$item.'`'; } } } //不需要操作的表 $jump = array( 0 =\u003e 't_const', 1 =\u003e 't_update_code', 2 =\u003e 't_properties_message', 3 =\u003e 't_error_code', 4 =\u003e 't_properties_mail' ); //跳过不需要操作的表 if(!in_array($sheetName, $jump)){ //把数据表的原先数据清空 $sSql = \"DELETE FROM \".$sheetName.\"\"; $res = mysql_query($sSql); if($res){ //循环读取每个单元格的内容。注意行从3开始，列从A开始 for ($rowIndex = 3; $rowIndex \u003c= $allRow; $rowIndex++) { $data = array(); for($colIndex='A'; $colIndex!=$allColumn; $colIndex++){ //空字段对应的列的数据都不插入数据表 if(!in_array($colIndex, $key)){ $addr = $colIndex . $rowIndex; $cell = $currentSheet-\u003egetCell($addr)-\u003egetValue(); if($cell instanceof PHPExcel_RichText){ //富文本转换字符串，不然就出现 PHPExcel_RichText Object $cell = $cell-\u003e__toString(); } array_push($data, $cell); } } foreach($data as $k =\u003e $item){ //防止和item里的引号冲突 if($k == 0){ $value .= '\"'.AddSlashes($item).'\"'; }else{ $value .= ','.'\"'.AddSlashes($item).'\"'; } } //把excel表中的数据都插入数据库 $sql = \"insert into \".$sheetName.\"(\".$field.\")\"; $sql .= \" values (\".$value.\")\"; $sql = 'insert into '.$sheetName.'('.$field.')'; $sql .= ' values ('.$value.')'; mysql_query('SET NAMES UTF8'); $res = mysql_query($sql); if($res){ //插入成功 //echo 1; }else{ echo $sql.'\u003cbr /\u003e\u003cbr /\u003e'; //插入失败，显示报错信息 //错误打log file_put_contents('errorlog/insert_error_'.$sheetName.'_'.date('Y-m-d').'.log','[START]------'.mysql_error().'------[END]'.date('Y-m-d H:i:s').PHP_EOL,FILE_APPEND); } unset($value); } }else{ echo mysql_error(); //错误打log file_put_contents('errorlog/delete_error_'.$sheetName.'_'.date('Y-m-d').'.log','[START]------'.mysql_error().'------[END]'.date('Y-m-d H:i:s').PHP_EOL,FILE_APPEND); } }else{ file_put_contents('errorlog/pass_'.$sheetName.'_'.date('Y-m-d').'.log','[START]------'.$sheetName.'表跳过导入------[END]'.date('Y-m-d H:i:s').PHP_EOL,FILE_APPEND); } unlink($filePath); sleep(1); } if(error_log()){ file_put_contents('errorlog/php_error_'.date('Y-m-d').'.log','[START]------'.error_log().'------[END]'.date('Y-m-d H:i:s').PHP_EOL,FILE_APPEND); } echo '用时：'. ( microtime(TRUE) - FY_MTIME ); 如果导入数据库的数据有出现“=某个单元格”（=A3），就先把.xls文件转为.csv文件，再按上面的代码导入数据库。 转格式的做法在下面的链接里： xls文件转csv文件 ","date":"2018-01-06","objectID":"/posts/php-excle/:0:0","tags":["php"],"title":"PHPExcle导excle表到数据库","uri":"/posts/php-excle/"},{"categories":["php"],"content":"当要使用多维数组中的某个值来作排序时，可以使用下面的代码： （通过学习《深入理解PHP 高级技巧、面向对象与核心技术》的方法所得） \u003c?php header(\"Content-type: text/html; charset=utf-8\"); $student = array( 256 =\u003e array('name' =\u003e 'C','grade' =\u003e 100), 2 =\u003e array('name' =\u003e 'A','grade' =\u003e 80), 9 =\u003e array('name' =\u003e 'D','grade' =\u003e 90), 364 =\u003e array('name' =\u003e 'E','grade' =\u003e 80), 68 =\u003e array('name' =\u003e 'B','grade' =\u003e 70), ); function name_sort($x,$y){ return strcasecmp($x['name'], $y['name']); } function grade_sort($x,$y){ return ($x['grade'] \u003c $y['grade']); } echo '\u003ch2\u003e原本数组为\u003c/h2\u003e\u003cpre\u003e'.print_r($student,1) .'\u003c/pre\u003e'; uasort($student, 'name_sort'); echo '\u003ch2\u003e通过名字排序所得数组\u003c/h2\u003e\u003cpre\u003e'.print_r($student,1) .'\u003c/pre\u003e'; uasort($student, 'grade_sort'); echo '\u003ch2\u003e通过成绩排序所得数组\u003c/h2\u003e\u003cpre\u003e'.print_r($student,1) .'\u003c/pre\u003e'; ","date":"2017-11-16","objectID":"/posts/multidimensional-array-sorting/:0:0","tags":["php"],"title":"多维数组排序","uri":"/posts/multidimensional-array-sorting/"},{"categories":["php"],"content":"如果想用一个自定义的域名来访问自己本地的项目，有以下步骤： 1、进入到“C:\\Windows\\System32\\drivers\\etc”的目录下，找到 hosts 这个文件，打开修改，在最后一行写上： 127.0.0.1 www.xxxx.com 写好后保存关闭； 2、找到Apache下的 httpd.conf 文件，打开修改，查找到“DocumentRoot”的所在行，在原先的根目录路径的基础上加上你的文件夹名，如： 原先的是： DocumentRoot \"D:/wamp/www/\" 现在改成： DocumentRoot \"D:/wamp/www/tp\" 即可 ","date":"2017-08-15","objectID":"/posts/php-hosts/:0:0","tags":["php"],"title":"php本地地址改成域名访问","uri":"/posts/php-hosts/"},{"categories":["linux"],"content":"在服务器上用 vi -b 查看脚本的时候，发现里面每一行结尾都有 ^M 这个东西。 解决办法是： 1.先 vi -b 打要修改的脚本； 2.按一下 Esc ，然后输入 :%s/.$//g ，然后回车； 3.保存退出即可。 再 vi-b 查看时，每一行的 ^M 已经不见了 ","date":"2017-07-29","objectID":"/posts/linux-del-m/:0:0","tags":["linux"],"title":"Linux下去掉^M的方法","uri":"/posts/linux-del-m/"},{"categories":["php"],"content":"$aLines = Array ( [0] =\u003e Array ( [0] =\u003e 8 [1] =\u003e 30208201 [2] =\u003e 3 ) [1] =\u003e Array ( [0] =\u003e 1 [1] =\u003e 2 [2] =\u003e 1 ) [2] =\u003e Array ( [0] =\u003e 8 [1] =\u003e 30208204 [2] =\u003e 1 ) [3] =\u003e Array ( [0] =\u003e 8 [1] =\u003e 30208205 [2] =\u003e 1 ) ) $count = count($aLines);//统计多少个数组 if($count != 1){ $array=array(); $k = 0; $setsql = ' , had_attachment = 1 ';//测试 foreach($aLines as $arr){ if($arr[1] == 2){ $setsql .= \" , attachment_gold = \".$arr[1].\" \"; }else{ if (!array_key_exists($arr[1],$array)){ //检查键名是否存在于数组中,没有就存进去。 $array[$k]=array($arr[1]); } $tab[$k][0]=$arr[0]; $tab[$k][1]=$arr[1]; $tab[$k][2]=$arr[2]; } $k++; } $w = json_encode(array_values($array)); $setsql .= \" , attachment_items = '\".$w.\"' \"; } echo $setsql; ","date":"2017-06-19","objectID":"/posts/splice-array/:0:0","tags":["php"],"title":"php拼接数组","uri":"/posts/splice-array/"},{"categories":["mysql"],"content":"在linux下连接了数据库之后，网页上显示Access denied for user ‘root’@’%’ to database ‘xxx’的字样时， 通过数据库授权： grant all on xxx.* to ‘root’@’%’ identified by ‘password’ with grant option; 其中：xxx代表创建的数据库; password为用户密码。 ","date":"2017-06-19","objectID":"/posts/access-denied/:0:0","tags":["mysql"],"title":"访问网站出现Access denied for user 'root'@'%' to database 'xxx'","uri":"/posts/access-denied/"},{"categories":null,"content":"Hello World！😂 ","date":"2017-06-09","objectID":"/posts/my-first-post.en/:0:0","tags":null,"title":"My First Post","uri":"/posts/my-first-post.en/"},{"categories":null,"content":"你好呀！😂 ","date":"2017-06-09","objectID":"/posts/my-first-post/:0:0","tags":null,"title":"我的第一篇博客","uri":"/posts/my-first-post/"}]